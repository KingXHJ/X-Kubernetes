## Docker Network Basic
在Linux的网络命名空间中可以有自己独立的路由表及独立的iptables设置来提供包转发、NAT及IP包过滤等功能


### 网络命名空间
1. 网络命名空间的实现
1. 对网络命名空间的操作
1. 网络命名空间操作中的实用技巧

### Veth设备对
引入 Veth 设备对是为了在不同的网络命名空间之间通信，利用它可以直接将两个网络命名空间连接起来。由于要连接两个网络命名空间，所以 Veth 设备都是成对出现的，很像一对以太网卡，并且中间有一根直连的网线。既然是一对网卡，那么我们将其中一端称为另一端的 peer。在 Veth 设备的一端发送数据时，它会将数据直接发送到另一端，并触发另一端的接收操作

1. 对Veth设备对的操作命令
    - 在Docker内部，Veth设备对也是连通容器与宿主机的主要网络设备
1. Veth设备对如何查看对端

### 网桥
网桥是一个二层的虚拟网络设备，把若干个网络接口“连接”起来，以使得网络接口之间的报文能够相互转发。网桥能够解析收发的报文，读取目标 MAC 地址的信息，将其与自己记录的 MAC 表结合，来决策报文的转发目标网络接口。为了实现这些功能，网桥会学习源 MAC 地址（二层网桥转发的依据就是 MAC 地址 ）。在转发报文时，网桥只需向特定的网口进行转发，来避免不必要的网络交互。如果它遇到一个自己从未学习到的地址，就无法知道这个报文应该向哪个网络接口转发，将报文广播给所有的网络接口（报文来源的网络接口除外）

在实际的网络中，网络拓扑不可能永久不变。设备如果被移动到另一个端口上，却没有发送任何数据，网桥设备就无法感知这个变化，网桥还是向原来的端口转发数据包，在这种情况下数据会丢失。所以网桥还要对学习到的 MAC 地址表加上超时时间（默认为5min）如果网桥收到了对应端口 MAC 地址回发的包，则重置超时时间，否则过了超时时间，就认为设备已经不在那个端口上了，它会重新广播发送

在 Linux 的内部网络栈里实现的网桥设备，作用和上面的描述相同。Linux 主机过去一般只有一个网卡，现在多网卡的机器越来越多，而且有很多虚拟设备存在，所以 Linux 网桥提供了在这些设备之间相互转发数据的二层设备

Linux 内核支持网口的桥接（目前只支持以太网接口）。但是与单纯的交换机不同，交换机只是一个二层设备，对于接收到的报文，要么转发，要么丢弃。运行着 Linux 内核的机器本身就是一台主机，有可能是网络报文的目的地，其收到的报文除了转发和丢弃，还可能被送到网络协议栈的上层（网络层），从而被自己（这台主机本身的协议栈）消化，所以我们既可以把网桥看作一个二层设备，也可以把它看作一个三层设备

1. Linux网桥的实现
    - Linux内核是通过一个虚拟网桥设备 (Net Device) 来实现桥接的。这个虚拟设备可以绑定若干个以太网接口设备，从而将它们桥接起来。这种 Net Device 网桥和普通的设备不同，最明显的一个特性是它还可以有一个IP地址
1. 网桥的常用操作命令


### iptables和Netfilter
Netfilter 负责在内核中执行各种挂接的规则，运行在内核模式中；而  iptables 是在用户模式下运行的进程，负责协助和维护内核中 Netfilter 的各种规则表。二者相互配合来实现整个 Linux 网络协议栈中灵活的数据包处理机制

1. 规则表Table
    - 类型支持：
        1. RAW（优先级最高）
        1. MANGLE
        1. NAT
        1. FILTER（优先级最低）

1. 处理规则
    - 规则特性：
        1. 表类型（准备干什么事情）
        1. 什么挂接点（什么时候起作用）
        1. 匹配的参数是什么（针对什么样的数据包）
        1. 匹配后有什么动作（匹配后具体的操作是什么）
    1. 匹配的参数
    1. 匹配后的动作
1. iptables命令

### 路由
一个典型的路由表条目通常包含以下主要的条目项：
1. 目的IP地址
1. 下一个路由器的IP地址
1. 标志
1. 网络接口规范

#### 1 路由表的创建
Linux 的路由表至少包括两个表（当启用策略路由时，还会有其他表）：一个是 LOCAL，另一个是 MAIN。在 LOCAL 表中会包含所有本地设备地址。LOCAL 路由表是在配置网络设备地址时自动创建的。LOCAL 表用于供 Linux 协议栈识别本地地址，以及进行本地各个不同网络接口之间的数据转发

MAIN 表用于各类网络 IP 地址的转发。它的建立既可以使用静态配置生成，也可以使用动态路由发现协议生成。动态路由发现协议一般使用组播功能来通过发送路由发现数据，动态地交换和获取网络的路由信息，并更新到路由表中。

#### 2 路由表的查看
在显示的信息中，如果标志（Flag）是U（代表 Up），则说明该路由是有效的；如果标志是G（代表 Gateway），则说明这个网络接口连接的是网关；如果标志是H（代表 Host），则说明目的地是主机而非网络域，等等